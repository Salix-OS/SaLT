# vim: syn=sh et sw=2 st=2 ts=2 tw=0:

function load_video {
  insmod vbe
  insmod vga
}

function initmenu {
  set timeout=20
  if loadfont $cfgprefix/unicode.pf2 ; then
    set gfxmode=640x480
    load_video
    insmod gfxterm
    terminal_output gfxterm
  fi
  insmod png
  if background_image $cfgprefix/bg.png ; then
    set menu_color_normal=light-cyan/black
    set menu_color_highlight=white/cyan
    set color_normal=white/black
  fi
}

function loadlocales {
  insmod gettext
  source $locale_dir/en_US.cfg
  source $locale_dir/$locale.cfg
}

function loadkeymap {
  set kbpath=$cfgprefix/keymaps/$kb.gkb
  if [ -f $kbpath ]; then
    keymap $kbpath
    if [ ! "$weird_usb_keyboard" = "true" ]; then
      # some weird USB config will have the keyboard unresponsible after loading at_keyboard
      terminal_input at_keyboard
    fi
  else
    # reset to us
    terminal_input console
  fi
}

function loadsettings {
  if [ -f $cfgprefix/salt.env ]; then
    load_env -f $cfgprefix/salt.env
  fi
}

# $1 = prompt string
# $2 = "boolean" or "string"
# $3 = error message string (not used in "string" mode)
# answer = result as "true" or "false" if "boolean", or the string
function getInput {
  if [ "$#" != "3" ]; then
    echo "getInput prompt boolean|string errorMessage"
    return 1
  elif [ ! "$2" = "boolean" -a ! "$2" = "string" ]; then
    echo "getInput prompt boolean|string errorMessage"
    return 2
  else
    while true; do
      echo -n "$1"
      read answer
      echo
      if [ "$2" = "boolean" ]; then
        if [ "$answer" = "${Lyes}" ]; then
          answer=true
          break;
        elif [ "$answer" = "${LYES}" ]; then
          answer=true
          break;
        elif [ "$answer" = "${Lno}" ]; then
          answer=false
          break;
        elif [ "$answer" = "${LNO}" ]; then
          answer=false
          break;
        elif [ "$answer" = "" ]; then
          break;
        else
          echo "$3"
        fi
      else
        break;
      fi
    done
  fi
}
