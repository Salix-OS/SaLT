function load_video {
  insmod vbe
  insmod vga
  # disabled to prevent gfxpayload=keep from breaking
  #insmod video_bochs
  #insmod video_cirrus
}

function initmenu {
  set timeout=20
  if loadfont ${cfgprefix}/unicode.pf2 ; then
    set gfxmode=640x480
    load_video
    insmod gfxterm
    terminal_output gfxterm
  fi
  insmod png
  if background_image ${cfgprefix}/bg.png ; then
    set menu_color_normal=light-cyan/black
    set menu_color_highlight=white/cyan
    set color_normal=white/black
  fi
}

function loadlocales {
  insmod gettext
  source ${locale_dir}/en_US.cfg
  source ${locale_dir}/${locale}.cfg
}

function loadkeymap {
  set kbpath=${cfgprefix}/keymaps/${kb}.gkb
  if test -f ${kbpath}; then
    keymap ${kbpath}
    terminal_input at_keyboard
  else
    # reset to us
    terminal_input console
  fi
}

function loadsettings {
  if [ -f $cfgprefix/salt.env ]; then
    load_env -f $cfgprefix/salt.env
  fi
}
